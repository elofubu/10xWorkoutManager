@using WorkoutManager.BusinessLogic.DTOs
<MudDialog Class="overflow-hidden">
    <TitleContent>
        <MudText Typo="Typo.h6">Add Exercise</MudText>
    </TitleContent>
    <DialogContent>
        @if (_isLoading)
        {
            <MudProgressLinear Color="Color.Info" Indeterminate="true" />
        }
        else
        {
            <MudTextField Margin="Margin.Dense" Variant="Variant.Outlined" T="string" Label="Search" @bind-Value="_search"
                          DebounceInterval="300" OnDebounceIntervalElapsed="SearchExercises" Disabled="@_isSearching" />
            <MudSelect T="long?" Margin="Margin.Dense" Variant="Variant.Outlined" Label="Muscle Group" @bind-Value="_selectedMuscleGroupId" SelectedValuesChanged="SearchExercises"
                       Clearable="true" OnClearButtonClick="ClearFilter" Disabled="@_isSearching">
                @foreach (var group in _muscleGroups)
                {
                    <MudSelectItem Value="@((long?)group.Id)">@group.Name</MudSelectItem>
                }
            </MudSelect>
        }

        @if (_isSearching)
        {
            <MudProgressLinear Color="Color.Info" Indeterminate="true" />
        }

        <MudList T="ExerciseDto" Style="height: 300px" Class="overflow-scroll">
            @if (_isLoading || _isSearching)
            {
                <MudListItem Class="mud-list-padding">
                    <MudText Align="Align.Center" Color="Color.Secondary">
                        <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" />
                        Loading exercises...
                    </MudText>
                </MudListItem>
            }
            else if (!_exercises.Any())
            {
                <MudListItem Class="mud-list-padding">
                    <MudText Align="Align.Center" Color="Color.Secondary">No exercises found</MudText>
                </MudListItem>
            }
            else
            {
                @foreach (var exercise in _exercises)
                {
                    <MudListItem T="ExerciseDto" @onclick="() => SelectExercise(exercise)" Class="cursor-pointer">
                        @exercise.Name
                    </MudListItem>
                }
            }
        </MudList>
        @if (PageCount > 1)
        {
            <MudPagination Count="PageCount" SelectedChanged="PageChanged" Disabled="@_isSearching" />
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" Disabled="@_isSearching">Cancel</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="OpenCreateExerciseDialog" Disabled="@_isSearching">Create New</MudButton>
    </DialogActions>
</MudDialog>

@inherits LayoutComponentBase
@inject IAuthService AuthService
@inject NavigationManager NavigationManager
@using Microsoft.AspNetCore.Components.Authorization
@using WorkoutManager.Web.Services

<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />
<MudPopoverProvider />

<AuthorizeView>
    <Authorized>
        <MudLayout>
            <MudAppBar>
                <MudIcon Icon="material-symbols-outlined/exercise" />
                <span class="page-title">WorkoutManager</span
                <MudSpacer />
                <MudText>@context.User.Identity.Name</MudText> 
                <MudIconButton Icon="@Icons.Material.Filled.Logout" aria-label="Logout" Color="Color.Inherit" OnClick="Logout" />
            </MudAppBar>
            <MudMainContent Class="pb-16">
                <MudContainer MaxWidth="MaxWidth.Large" Class="my-4 pt-4">
                    <WorkoutManager.Web.Helpers.GLobalErrorBoundary>
                        @Body
                    </WorkoutManager.Web.Helpers.GLobalErrorBoundary>
                </MudContainer>
            </MudMainContent>
        <NavMenu />
        </MudLayout>
    </Authorized>
    <NotAuthorized>
        <WorkoutManager.Web.Components.RedirectToLogin />
    </NotAuthorized>
</AuthorizeView>

<style>
    .mud-appbar {
        background: var(--color-primary-background-element);
        color: var(--color-secondary-text);
    }
    .page-title{
        color: white;
        font-size: 1.2rem;
        font-weight: 600;
        margin-left: 10px;
    }
</style>

@code {
    bool _drawerOpen = true;

    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }

    private async Task Logout()
    {
        await AuthService.LogoutAsync();
        ((SupabaseAuthenticationStateProvider)AuthenticationStateProvider).NotifyUserAuthenticationStateChanged();
        NavigationManager.NavigateTo("/authentication/login");
    }

    [Inject]
    private AuthenticationStateProvider AuthenticationStateProvider { get; set; }
}
